
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>physarum &#8212; physarum  documentation</title>
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/alabaster.css" type="text/css" />
    <script id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/language_data.js"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <h1>Source code for physarum</h1><div class="highlight"><pre>
<span></span>
<span class="c1"># standards:</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>

<span class="c1"># image utils:</span>
<span class="kn">from</span> <span class="nn">PIL</span> <span class="kn">import</span> <span class="n">Image</span> <span class="k">as</span> <span class="n">IMG</span>
<span class="kn">from</span> <span class="nn">IPython.display</span> <span class="kn">import</span> <span class="n">Image</span>
<span class="kn">from</span> <span class="nn">skimage</span> <span class="kn">import</span> <span class="n">data</span><span class="p">,</span> <span class="n">color</span>
<span class="kn">from</span> <span class="nn">skimage.transform</span> <span class="kn">import</span> <span class="n">rescale</span><span class="p">,</span> <span class="n">resize</span><span class="p">,</span> <span class="n">downscale_local_mean</span>
<span class="kn">import</span> <span class="nn">cv2</span>  <span class="c1"># for rescaling</span>

<span class="c1"># for the blurring:</span>
<span class="kn">from</span> <span class="nn">scipy.ndimage.filters</span> <span class="kn">import</span> <span class="n">gaussian_filter</span><span class="p">,</span> <span class="n">uniform_filter</span><span class="p">,</span> <span class="n">median_filter</span>


<span class="kn">import</span> <span class="nn">scipy.spatial</span> <span class="k">as</span> <span class="nn">spatial</span>

<span class="c1"># to monitor progress:</span>
<span class="kn">import</span> <span class="nn">tqdm</span>

<span class="c1"># to save movies:</span>
<span class="kn">import</span> <span class="nn">imageio</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span>

<span class="c1"># for colormaps</span>
<span class="kn">import</span> <span class="nn">palettable</span>
<span class="kn">import</span> <span class="nn">cmocean</span>
<span class="kn">from</span> <span class="nn">colorsys</span> <span class="kn">import</span> <span class="n">hls_to_rgb</span>
<span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">cm</span>
<span class="kn">from</span> <span class="nn">matplotlib.colors</span> <span class="kn">import</span> <span class="n">ListedColormap</span><span class="p">,</span> <span class="n">LinearSegmentedColormap</span>

<span class="c1"># to speed up computation</span>
<span class="kn">import</span> <span class="nn">numba</span>

<span class="c1"># noise for the starting-positions:</span>
<span class="kn">import</span> <span class="nn">noise</span>
<span class="kn">from</span> <span class="nn">scipy</span> <span class="kn">import</span> <span class="n">interpolate</span>

<span class="c1"># to distribute walking-speeds over range</span>
<span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">minmax_scale</span>


<div class="viewcode-block" id="physarum_population"><a class="viewcode-back" href="../physarum.html#physarum.physarum_population">[docs]</a><span class="k">class</span> <span class="nc">physarum_population</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;A class that contains the parameters that set up a physarum-population and keep track of its development.</span>

<span class="sd">        :param t: Time for which the simulation will run.</span>

<span class="sd">        :type t: int, defaults to 400.</span>

<span class="sd">        :param timestep: Current timestep of the organisms life. Starts at zero, gets updated in the simulation-loop.</span>

<span class="sd">        :type timestep: int, defaults to 0.</span>
<span class="sd">        :param height: height of the simulation-field the population lives in.</span>
<span class="sd">        :type height: int, defaults to 1000.</span>
<span class="sd">        :param width: width of the simulation-field the population lives in.  Defaults to 1000.</span>
<span class="sd">        :param horizon_walk: How far the cells walk every-step. Either float or list of floats that</span>
<span class="sd">                        will be distributed over the total time t, so that the value at every timestep is</span>
<span class="sd">                        approximated through a spline over the values given in the list.</span>
<span class="sd">        :param horizon_sense: How far each cell looks out before itself, to check where to go. Either float or a list of floats that</span>
<span class="sd">                        will be distributed over the total time t, so that the value at every timestep is</span>
<span class="sd">                        approximated through a spline over the values given in the list.</span>
<span class="sd">        :param theta_walk: Angle in degrees that the cell turns left or right on every step. Either float or list of floats that</span>
<span class="sd">                        will be distributed over the total time t, so that the value at every timestep is</span>
<span class="sd">                        approximated through a spline over the values given in the list.</span>
<span class="sd">        :param theta_sense: Angle in degrees that the cell checks on the left or right to decide where to go. Either float or a list of floats that</span>
<span class="sd">                        will be distributed over the total time t, so that the value at every timestep is</span>
<span class="sd">                        approximated through a spline over the values given in the list.</span>
<span class="sd">        :param walk_range: Range that will be multiplied with the current horizon_walk value, so that the values for all cells</span>
<span class="sd">                        are randomly distributed over it. This allows for faster and slower cells in the same population. Float or tuple (e.g (0.9, 2.1))</span>
<span class="sd">        :param trace_strength: Strength of the trace left by the population. This allows to weight different populations differently in their influence. Float, default .3</span>
<span class="sd">        :param colormap: matplotlib-colormap. Defaults to Curl_15 from palletable.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">t</span><span class="o">=</span><span class="mi">400</span><span class="p">,</span>
        <span class="n">timestep</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
        <span class="n">height</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span>
        <span class="n">width</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span>
        <span class="n">horizon_walk</span><span class="o">=</span><span class="mf">10.0</span><span class="p">,</span>
        <span class="n">horizon_sense</span><span class="o">=</span><span class="mf">40.0</span><span class="p">,</span>
        <span class="n">theta_walk</span><span class="o">=</span><span class="mf">20.0</span><span class="p">,</span>
        <span class="n">theta_sense</span><span class="o">=</span><span class="mf">20.0</span><span class="p">,</span>
        <span class="n">walk_range</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span>
        <span class="n">trace_strength</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span>
        <span class="n">colormap</span><span class="o">=</span><span class="n">palettable</span><span class="o">.</span><span class="n">cmocean</span><span class="o">.</span><span class="n">diverging</span><span class="o">.</span><span class="n">Curl_15</span><span class="o">.</span><span class="n">mpl_colormap</span><span class="p">,</span>
        <span class="n">social_behaviour</span><span class="o">=-</span><span class="mf">0.5</span><span class="p">,</span>
        <span class="n">initialization</span><span class="o">=</span><span class="p">[[</span><span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">]],</span>
        <span class="n">template</span><span class="o">=</span><span class="s2">&quot;None&quot;</span><span class="p">,</span>
        <span class="n">template_strength</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Initialize a physarum-population, with sensible defaults.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">height</span> <span class="o">=</span> <span class="n">height</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">width</span> <span class="o">=</span> <span class="n">width</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">walk_range</span> <span class="o">=</span> <span class="n">walk_range</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">horizon_sense</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="n">horizon_sense</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">theta_walk</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="n">theta_walk</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">theta_sense</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="n">theta_sense</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">initialization</span> <span class="o">=</span> <span class="n">initialization</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">colormap</span> <span class="o">=</span> <span class="n">colormap</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">social_behaviour</span> <span class="o">=</span> <span class="n">social_behaviour</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">trace_strength</span> <span class="o">=</span> <span class="n">trace_strength</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">template_strength</span> <span class="o">=</span> <span class="n">template_strength</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">([</span><span class="n">i</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">initialization</span><span class="p">]),</span>
            <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">([</span><span class="n">i</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">initialization</span><span class="p">])</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">),</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">n</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">int64</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>  <span class="c1"># here we should check xy dimensions</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">horizon_walk</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="n">horizon_walk</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">walk_range</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">random_walking_base</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n</span><span class="p">))</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span>
                <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span>
            <span class="p">)</span>  <span class="c1"># This can be used to update later.</span>
            <span class="n">walking_constant</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">horizon_walk</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">horizon_walk</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">))</span>
                <span class="k">else</span> <span class="n">horizon_walk</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">walking_array</span> <span class="o">=</span> <span class="n">minmax_scale</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">random_walking_base</span><span class="p">,</span>
                <span class="n">feature_range</span><span class="o">=</span><span class="p">(</span>
                    <span class="n">walking_constant</span> <span class="o">*</span> <span class="n">walk_range</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                    <span class="n">walking_constant</span> <span class="o">*</span> <span class="n">walk_range</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                <span class="p">),</span>
            <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">angle</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">trace_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">height</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">width</span><span class="p">)))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">t</span> <span class="o">=</span> <span class="n">t</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">timestep</span> <span class="o">=</span> <span class="n">timestep</span>

        <span class="k">if</span> <span class="n">template</span> <span class="o">==</span> <span class="s2">&quot;None&quot;</span><span class="p">:</span>  <span class="c1"># hmm?</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">template</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">height</span><span class="p">,</span> <span class="n">width</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">template</span> <span class="o">=</span> <span class="n">template</span>

<div class="viewcode-block" id="physarum_population.add_organisms"><a class="viewcode-back" href="../physarum.html#physarum.physarum_population.add_organisms">[docs]</a>    <span class="k">def</span> <span class="nf">add_organisms</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">initialization</span><span class="o">=</span><span class="p">[[</span><span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">]]):</span>
        <span class="sd">&quot;&quot;&quot; Will allow for the addition of organisms during the loop. Not fully implemented yet.&quot;&quot;&quot;</span>

        <span class="n">new_x</span><span class="p">,</span> <span class="n">new_y</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">([</span><span class="n">i</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">initialization</span><span class="p">]),</span>
            <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">([</span><span class="n">i</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">initialization</span><span class="p">])</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">),</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">new_x</span><span class="p">]),</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="n">new_y</span><span class="p">])</span>

        <span class="n">new_angles</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span>
            <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="n">new_x</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">angle</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">angle</span><span class="p">,</span> <span class="n">new_angles</span><span class="p">])</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">walk_range</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)):</span>
            <span class="n">new_random_walking_base</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span>
                <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="n">new_x</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span>
                <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span>
            <span class="p">)</span>  <span class="c1"># This can be used to update later.</span>
            <span class="n">new_walking_array</span> <span class="o">=</span> <span class="n">minmax_scale</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">random_walking_base</span><span class="p">,</span>
                <span class="n">feature_range</span><span class="o">=</span><span class="p">(</span>
                    <span class="n">horizon_walk</span> <span class="o">*</span> <span class="n">walk_range</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                    <span class="n">horizon_walk</span> <span class="o">*</span> <span class="n">walk_range</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                <span class="p">),</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">walking_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">walking_array</span><span class="p">,</span> <span class="n">new_walking_array</span><span class="p">])</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">angle</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">walking_array</span>

        <span class="c1"># Add changing walking-array</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">angle</span></div>

    <span class="c1"># def get_point_density(self):</span>
    <span class="c1"># 	#not ideal, but faster than kde:</span>
    <span class="c1"># 	# build zero array, than add each point:</span>
    <span class="c1"># 	base = np.zeros(self.trace_array.shape)</span>
    <span class="c1"># 	self.trace_array[np.floor(self.x% (self.trace_array.shape[0])).astype(int),</span>
    <span class="c1"># 					np.floor(self.y% (self.trace_array.shape[1])).astype(int)] = trace_strength +  self.trace_array[np.floor(self.x% (self.trace_array.shape[0])).astype(int),</span>
    <span class="c1"># 																			np.floor(self.y% (self.trace_array.shape[1])).astype(int)]</span>

    <span class="c1"># def explode(self, top_n=5000, type=&#39;radial&#39;):</span>
    <span class="c1"># 	&quot;&quot;&quot; Moves the organisms in dense areas.&quot;&quot;&quot;</span>

<div class="viewcode-block" id="physarum_population.update_constant"><a class="viewcode-back" href="../physarum.html#physarum.physarum_population.update_constant">[docs]</a>    <span class="k">def</span> <span class="nf">update_constant</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">this_constant</span><span class="p">):</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">this_constant</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)):</span>
            <span class="n">anchors</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">t</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">this_constant</span><span class="p">))</span>
            <span class="n">spline_points</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">anchors</span><span class="p">,</span> <span class="n">this_constant</span><span class="p">])</span><span class="o">.</span><span class="n">T</span>
            <span class="n">tck</span> <span class="o">=</span> <span class="n">interpolate</span><span class="o">.</span><span class="n">splrep</span><span class="p">(</span>
                <span class="n">spline_points</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span>
                <span class="n">spline_points</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span>
                <span class="n">s</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                <span class="n">k</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">([</span><span class="nb">len</span><span class="p">(</span><span class="n">spline_points</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">])</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]),</span>
            <span class="p">)</span>
            <span class="k">return</span> <span class="n">interpolate</span><span class="o">.</span><span class="n">splev</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">timestep</span><span class="p">,</span> <span class="n">tck</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">this_constant</span></div>

    <span class="c1"># 			 except Exception:</span>
    <span class="c1"># 				 print(Exception)</span>
    <span class="c1"># 				 pass</span>

<div class="viewcode-block" id="physarum_population.leave_trace"><a class="viewcode-back" href="../physarum.html#physarum.physarum_population.leave_trace">[docs]</a>    <span class="k">def</span> <span class="nf">leave_trace</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">additive</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Each particle leaves it&#39;s pheromone trace on the trace array.</span>
<span class="sd">        If the trace is additive, it gets added, otherwise the trace array is set to the value of the trace.&quot;&quot;&quot;</span>

        <span class="n">trace_strength</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">update_constant</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">trace_strength</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">additive</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
            <span class="c1"># self.trace_array[np.floor(self.x% (self.trace_array.shape[0])).astype(int),</span>
            <span class="c1"># 			np.floor(self.y% (self.trace_array.shape[1])).astype(int)] = trace_strength +  self.trace_array[np.floor(self.x% (self.trace_array.shape[0])).astype(int),</span>
            <span class="c1"># 																	np.floor(self.y% (self.trace_array.shape[1])).astype(int)]</span>
            <span class="c1">#</span>
            <span class="c1"># for i,j in zip(self.x,self.y):</span>
            <span class="c1"># 	self.trace_array[np.floor(i % (self.trace_array.shape[0])).astype(int),</span>
            <span class="c1"># 			np.floor(j % (self.trace_array.shape[1])).astype(int)] = trace_strength + self.trace_array[np.floor(i % (self.trace_array.shape[0])).astype(int),</span>
            <span class="c1"># 																	np.floor(j % (self.trace_array.shape[1])).astype(int)]</span>
            <span class="n">my_x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">trace_array</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
            <span class="n">my_y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">trace_array</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>

            <span class="n">vals</span><span class="p">,</span> <span class="n">idx_start</span><span class="p">,</span> <span class="n">count</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span>
                <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">([</span><span class="n">my_x</span><span class="p">,</span> <span class="n">my_y</span><span class="p">]),</span> <span class="n">return_counts</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">return_index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">trace_array</span><span class="p">[</span><span class="n">vals</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">vals</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">trace_array</span><span class="p">[</span>
                <span class="n">vals</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">vals</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span>
            <span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="n">count</span> <span class="o">*</span> <span class="n">trace_strength</span><span class="p">)</span>
            <span class="c1"># print(vals.shape, idx_start.shape, count.shape)</span>

            <span class="c1"># combined_coordinates = [&#39;_&#39;.join([str(a),str(b)]) for a,b in zip(my_x, my_y)]</span>
            <span class="c1"># print(combined_coordinates[0:100])</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">trace_array</span><span class="p">[</span>
                <span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">trace_array</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">),</span>
                <span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">trace_array</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">),</span>
            <span class="p">]</span> <span class="o">=</span> <span class="n">trace_strength</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">trace_array</span></div>

<div class="viewcode-block" id="physarum_population.diffuse_gaussian"><a class="viewcode-back" href="../physarum.html#physarum.physarum_population.diffuse_gaussian">[docs]</a>    <span class="k">def</span> <span class="nf">diffuse_gaussian</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sigma</span><span class="o">=</span><span class="mi">7</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;wrap&quot;</span><span class="p">,</span> <span class="n">truncate</span><span class="o">=</span><span class="mi">4</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Pheromones get distributed using gaussian smoothing.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">trace_array</span> <span class="o">=</span> <span class="n">gaussian_filter</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">trace_array</span><span class="p">,</span> <span class="n">sigma</span><span class="o">=</span><span class="n">sigma</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="n">mode</span><span class="p">,</span> <span class="n">truncate</span><span class="o">=</span><span class="n">truncate</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">trace_array</span></div>

<div class="viewcode-block" id="physarum_population.diffuse_uniform"><a class="viewcode-back" href="../physarum.html#physarum.physarum_population.diffuse_uniform">[docs]</a>    <span class="k">def</span> <span class="nf">diffuse_uniform</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;wrap&quot;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Pheromones get distributed using uniform smoothing. This can lead to nice artefacts,</span>
<span class="sd">        but also to diagonal drift at high values for size (?)&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">trace_array</span> <span class="o">=</span> <span class="n">uniform_filter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">trace_array</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">size</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="n">mode</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">trace_array</span></div>

<div class="viewcode-block" id="physarum_population.diffuse_median"><a class="viewcode-back" href="../physarum.html#physarum.physarum_population.diffuse_median">[docs]</a>    <span class="k">def</span> <span class="nf">diffuse_median</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;wrap&quot;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Pheromones get distributed using uniform smoothing. This can lead to nice artefacts,</span>
<span class="sd">        but also to diagonal drift at high values for size (?)&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">trace_array</span> <span class="o">=</span> <span class="n">median_filter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">trace_array</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">size</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="n">mode</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">trace_array</span></div>

<div class="viewcode-block" id="physarum_population.update_positions"><a class="viewcode-back" href="../physarum.html#physarum.physarum_population.update_positions">[docs]</a>    <span class="k">def</span> <span class="nf">update_positions</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other_populations</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Intermediate function, to get everythin in order for numba&quot;&quot;&quot;</span>
        <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span>
        <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span>
        <span class="n">angle</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">angle</span>
        <span class="n">theta_sense</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">update_constant</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">theta_sense</span><span class="p">)</span>
        <span class="n">horizon_sense</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">update_constant</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">horizon_sense</span><span class="p">)</span>
        <span class="n">theta_walk</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">update_constant</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">theta_walk</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">walk_range</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)</span>
        <span class="p">):</span>  <span class="c1"># If we specified a range for walking, we adapt the walking array to it, and pass it to the calculation of the new positions. Otherwise we pass the constant.</span>
            <span class="n">walking_constant</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">update_constant</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">horizon_walk</span><span class="p">)</span>
            <span class="n">horizon_walk</span> <span class="o">=</span> <span class="n">minmax_scale</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">random_walking_base</span><span class="p">,</span>
                <span class="n">feature_range</span><span class="o">=</span><span class="p">(</span>
                    <span class="n">walking_constant</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">walk_range</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                    <span class="n">walking_constant</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">walk_range</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                <span class="p">),</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">horizon_walk</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">update_constant</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">horizon_walk</span><span class="p">)</span>

        <span class="n">adapted_trace_array</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">trace_array</span>
        <span class="n">other_populations</span> <span class="o">=</span> <span class="n">other_populations</span>
        <span class="n">social_behaviour</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">update_constant</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">social_behaviour</span><span class="p">)</span>
        <span class="n">template</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">template</span>
        <span class="n">template_strength</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">update_constant</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">template_strength</span><span class="p">)</span>

        <span class="c1"># 		 density_cutoff = np.max(self.trace_array) - explosion_proneness</span>
        <span class="c1"># 		 print(density_cutoff)</span>
        <span class="c1"># 		 print(np.max(self.trace_array))</span>
        <span class="n">adapted_trace_array</span> <span class="o">=</span> <span class="n">adapted_trace_array</span> <span class="o">+</span> <span class="p">(</span><span class="n">template</span> <span class="o">*</span> <span class="n">template_strength</span><span class="p">)</span>

        <span class="k">for</span> <span class="p">(</span>
            <span class="n">this_pop</span>
        <span class="p">)</span> <span class="ow">in</span> <span class="p">(</span>
            <span class="n">other_populations</span>
        <span class="p">):</span>  <span class="c1"># include the other species-patterns in the present ones feeding-behaviour</span>
            <span class="n">adapted_trace_array</span> <span class="o">=</span> <span class="n">adapted_trace_array</span> <span class="o">+</span> <span class="p">(</span><span class="n">this_pop</span> <span class="o">*</span> <span class="n">social_behaviour</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">angle</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">numba_update_positions</span><span class="p">(</span>
            <span class="n">x</span><span class="p">,</span>
            <span class="n">y</span><span class="p">,</span>
            <span class="n">angle</span><span class="p">,</span>
            <span class="n">theta_sense</span><span class="p">,</span>
            <span class="n">horizon_sense</span><span class="p">,</span>
            <span class="n">theta_walk</span><span class="p">,</span>
            <span class="n">horizon_walk</span><span class="p">,</span>
            <span class="n">trace_array</span><span class="o">=</span><span class="n">adapted_trace_array</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">angle</span></div>

<div class="viewcode-block" id="physarum_population.numba_update_positions"><a class="viewcode-back" href="../physarum.html#physarum.physarum_population.numba_update_positions">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="nd">@numba</span><span class="o">.</span><span class="n">njit</span><span class="p">(</span><span class="n">fastmath</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">numba_update_positions</span><span class="p">(</span>
        <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">angle</span><span class="p">,</span> <span class="n">theta_sense</span><span class="p">,</span> <span class="n">horizon_sense</span><span class="p">,</span> <span class="n">theta_walk</span><span class="p">,</span> <span class="n">horizon_walk</span><span class="p">,</span> <span class="n">trace_array</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Internal numba-function that returns the adapted physarum-positions, given initial coordinates and constants&quot;&quot;&quot;</span>

        <span class="c1"># check for high densities, and breack them up, if required: (currently not implemented.)</span>
        <span class="c1"># 		 for i in range(len(x)):</span>
        <span class="c1"># 			 current_density = trace_array[np.int64(np.floor(x[i][0])) -1, np.int64(np.floor(y[i][0])) -1]</span>

        <span class="c1"># 			 if current_density &gt; density_cutoff:</span>
        <span class="c1"># 				 angle[i] = np.random.rand()*(2*np.pi)</span>
        <span class="c1"># #				 angle[i] = np.random.rand()*(2*np.pi) # set angle to random</span>
        <span class="c1"># 				 x[i] = (x[i] + explosion_radius * np.cos(angle[i])) % (trace_array.shape[0])</span>
        <span class="c1"># 				 y[i] = (y[i] + explosion_radius * np.sin(angle[i])) % (trace_array.shape[1])</span>
        <span class="c1"># 		 else:</span>
        <span class="c1"># 			 pass</span>

        <span class="c1"># get values at potential new positions</span>
        <span class="n">angles_to_test</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">(</span>
            <span class="p">(</span>
                <span class="p">(</span><span class="n">angle</span> <span class="o">-</span> <span class="n">theta_sense</span><span class="p">)</span> <span class="o">%</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">),</span>
                <span class="n">angle</span><span class="p">,</span>
                <span class="p">(</span><span class="n">angle</span> <span class="o">+</span> <span class="n">theta_sense</span><span class="p">)</span> <span class="o">%</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">),</span>
            <span class="p">)</span>
        <span class="p">)</span>
        <span class="n">x_to_test</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span> <span class="o">+</span> <span class="n">horizon_sense</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">angles_to_test</span><span class="p">))</span> <span class="o">%</span> <span class="p">(</span>
            <span class="n">trace_array</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="p">)</span>  <span class="c1"># get coordinates and wrap around</span>
        <span class="n">y_to_test</span> <span class="o">=</span> <span class="p">(</span><span class="n">y</span> <span class="o">+</span> <span class="n">horizon_sense</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">angles_to_test</span><span class="p">))</span> <span class="o">%</span> <span class="p">(</span>
            <span class="n">trace_array</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="p">)</span>

        <span class="n">angles_to_walk</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">(</span>
            <span class="p">(</span>
                <span class="p">(</span><span class="n">angle</span> <span class="o">-</span> <span class="n">theta_walk</span><span class="p">)</span> <span class="o">%</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">),</span>
                <span class="n">angle</span><span class="p">,</span>
                <span class="p">(</span><span class="n">angle</span> <span class="o">+</span> <span class="n">theta_walk</span><span class="p">)</span> <span class="o">%</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">),</span>
            <span class="p">)</span>
        <span class="p">)</span>
        <span class="n">x_to_walk</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span> <span class="o">+</span> <span class="n">horizon_walk</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">angles_to_walk</span><span class="p">))</span> <span class="o">%</span> <span class="p">(</span>
            <span class="n">trace_array</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="p">)</span>  <span class="c1"># get coordinates and wrap around</span>
        <span class="n">y_to_walk</span> <span class="o">=</span> <span class="p">(</span><span class="n">y</span> <span class="o">+</span> <span class="n">horizon_walk</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">angles_to_walk</span><span class="p">))</span> <span class="o">%</span> <span class="p">(</span><span class="n">trace_array</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

        <span class="n">x_to_test_arr_coords</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">x_to_test</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">int64</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
        <span class="n">y_to_test_arr_coords</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">y_to_test</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">int64</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>

        <span class="c1"># get the trace-values at the lookup coordinates. Somewhat annoying in numba:</span>

        <span class="n">trace_outlooks</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="n">x_to_test_arr_coords</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">x_to_test_arr_coords</span><span class="p">)):</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">y_to_test_arr_coords</span><span class="p">[</span><span class="n">i</span><span class="p">])):</span>
                <span class="n">trace_outlooks</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">trace_array</span><span class="p">[</span>
                    <span class="n">x_to_test_arr_coords</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">],</span> <span class="n">y_to_test_arr_coords</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span>
                <span class="p">]</span>

        <span class="c1"># Get the highest trace-value for each position (left spin due to failing argmax?)</span>
        <span class="n">trace_max</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">trace_outlooks</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">trace_outlooks</span><span class="p">)):</span>
            <span class="n">trace_max</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">trace_outlooks</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
        <span class="n">rows</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">trace_outlooks</span> <span class="o">==</span> <span class="n">trace_max</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">rows_multiple_max</span> <span class="o">=</span> <span class="n">rows</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="n">rows</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="n">rows</span><span class="p">[</span><span class="mi">1</span><span class="p">:]]</span>

        <span class="n">where_best</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">trace_outlooks</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">trace_outlooks</span><span class="p">)):</span>
            <span class="n">where_best</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">trace_outlooks</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">argmax</span><span class="p">()</span>

        <span class="n">where_best</span><span class="p">[</span><span class="n">rows_multiple_max</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">trace_outlooks</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

        <span class="c1"># select the coordinates with the highest trace-value, and return</span>
        <span class="n">new_x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">trace_outlooks</span><span class="p">))</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">new_y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">trace_outlooks</span><span class="p">))</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">new_angle</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">trace_outlooks</span><span class="p">))</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">trace_outlooks</span><span class="p">)):</span>
            <span class="n">best_index</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">int64</span><span class="p">(</span><span class="n">where_best</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
            <span class="n">new_x</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">x_to_walk</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">best_index</span><span class="p">]</span>
            <span class="n">new_y</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">y_to_walk</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">best_index</span><span class="p">]</span>
            <span class="n">new_angle</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">angles_to_walk</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">best_index</span><span class="p">]</span>

        <span class="k">return</span> <span class="n">new_x</span><span class="p">,</span> <span class="n">new_y</span><span class="p">,</span> <span class="n">new_angle</span></div></div>


<span class="c1">##############	MaIN SIMULATION	#################</span>


<div class="viewcode-block" id="run_physarum_simulation"><a class="viewcode-back" href="../physarum.html#physarum.run_physarum_simulation">[docs]</a><span class="k">def</span> <span class="nf">run_physarum_simulation</span><span class="p">(</span>
    <span class="n">populations</span><span class="p">,</span>
    <span class="n">image_list</span><span class="p">,</span>
    <span class="n">additive_trace</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">diffusion</span><span class="o">=</span><span class="s2">&quot;uniform&quot;</span><span class="p">,</span>
    <span class="n">mask</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">cmap_rescaling</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;sqrt&quot;</span><span class="p">,</span> <span class="s2">&quot;normalize&quot;</span><span class="p">],</span>
    <span class="n">decay</span><span class="o">=</span><span class="mf">0.9</span><span class="p">,</span>
    <span class="n">show_image_every</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span>
    <span class="n">img_rescale</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span>
<span class="p">):</span>

    <span class="n">width</span><span class="p">,</span> <span class="n">height</span> <span class="o">=</span> <span class="n">populations</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">width</span><span class="p">,</span> <span class="n">populations</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">height</span>

    <span class="k">for</span> <span class="n">this_step</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="o">.</span><span class="n">tqdm_notebook</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">populations</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">t</span><span class="p">)):</span>

        <span class="c1"># Adding stuff along the simulation (not fully implemented into the function yet.)</span>
        <span class="c1"># 		 if this_step in [int(x) for x in np.linspace(0,400,30)]:</span>
        <span class="c1"># 			 species_c.add_organisms(initialization=[physarum.get_filled_circle_init(n=10000, center=(np.random.randint(width),np.random.randint(height)),radius=np.random.randint(10,high=40)) for x in range(0,1)])</span>

        <span class="n">species_images</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">ix</span><span class="p">,</span> <span class="n">this_species</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">populations</span><span class="p">):</span>
            <span class="n">this_species</span><span class="o">.</span><span class="n">timestep</span> <span class="o">=</span> <span class="n">this_step</span>

            <span class="n">this_species</span><span class="o">.</span><span class="n">leave_trace</span><span class="p">(</span><span class="n">additive</span><span class="o">=</span><span class="n">additive_trace</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">diffusion</span> <span class="o">==</span> <span class="s2">&quot;uniform&quot;</span><span class="p">:</span>
                <span class="n">this_species</span><span class="o">.</span><span class="n">diffuse_uniform</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">diffusion</span> <span class="o">==</span> <span class="s2">&quot;median&quot;</span><span class="p">:</span>
                <span class="n">this_species</span><span class="o">.</span><span class="n">diffuse_median</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">diffusion</span> <span class="o">==</span> <span class="s2">&quot;gaussian&quot;</span><span class="p">:</span>
                <span class="n">this_species</span><span class="o">.</span><span class="n">diffuse_gaussian</span><span class="p">(</span><span class="n">sigma</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;wrap&quot;</span><span class="p">,</span> <span class="n">truncate</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>

            <span class="c1"># We can set a predifined mask, e.g. for labyrinths:</span>
            <span class="k">if</span> <span class="n">mask</span> <span class="o">!=</span> <span class="kc">False</span><span class="p">:</span>
                <span class="n">this_species</span><span class="o">.</span><span class="n">trace_array</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>

            <span class="n">other_populations</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">populations</span><span class="p">)</span> <span class="k">if</span> <span class="n">i</span> <span class="o">!=</span> <span class="n">ix</span><span class="p">]</span>
            <span class="n">other_populations</span> <span class="o">=</span> <span class="p">[</span><span class="n">species</span><span class="o">.</span><span class="n">trace_array</span> <span class="k">for</span> <span class="n">species</span> <span class="ow">in</span> <span class="n">other_populations</span><span class="p">]</span>
            <span class="n">this_species</span><span class="o">.</span><span class="n">update_positions</span><span class="p">(</span><span class="n">other_populations</span><span class="o">=</span><span class="n">other_populations</span><span class="p">)</span>
            <span class="n">im</span> <span class="o">=</span> <span class="n">this_species</span><span class="o">.</span><span class="n">trace_array</span>

            <span class="k">if</span> <span class="s2">&quot;sqrt&quot;</span> <span class="ow">in</span> <span class="n">cmap_rescaling</span><span class="p">:</span>
                <span class="n">im</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">im</span> <span class="o">+</span> <span class="mf">0.1</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mf">0.1</span><span class="p">)</span>

            <span class="k">if</span> <span class="s2">&quot;log&quot;</span> <span class="ow">in</span> <span class="n">cmap_rescaling</span><span class="p">:</span>
                <span class="n">im</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">im</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>

            <span class="k">if</span> <span class="s2">&quot;normalize&quot;</span> <span class="ow">in</span> <span class="n">cmap_rescaling</span><span class="p">:</span>
                <span class="n">im</span> <span class="o">=</span> <span class="p">(</span><span class="n">im</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">im</span><span class="p">))</span> <span class="o">/</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">im</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">im</span><span class="p">))</span>

            <span class="n">im</span> <span class="o">=</span> <span class="n">this_species</span><span class="o">.</span><span class="n">colormap</span><span class="p">(</span><span class="n">im</span><span class="p">)</span>
            <span class="n">im</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">(</span><span class="n">im</span> <span class="o">*</span> <span class="mi">255</span><span class="p">)</span>
            <span class="n">im</span> <span class="o">=</span> <span class="n">IMG</span><span class="o">.</span><span class="n">fromarray</span><span class="p">(</span><span class="n">im</span><span class="p">)</span><span class="o">.</span><span class="n">convert</span><span class="p">(</span><span class="s2">&quot;RGBA&quot;</span><span class="p">)</span>

            <span class="n">species_images</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">im</span><span class="p">)</span>
            <span class="n">this_species</span><span class="o">.</span><span class="n">trace_array</span> <span class="o">=</span> <span class="n">this_species</span><span class="o">.</span><span class="n">trace_array</span> <span class="o">*</span> <span class="n">decay</span>

        <span class="n">im</span> <span class="o">=</span> <span class="n">species_images</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">image_to_concat</span> <span class="ow">in</span> <span class="n">species_images</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span>
            <span class="n">im</span> <span class="o">=</span> <span class="n">IMG</span><span class="o">.</span><span class="n">alpha_composite</span><span class="p">(</span><span class="n">im</span><span class="p">,</span> <span class="n">image_to_concat</span><span class="p">)</span>

        <span class="n">image_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">im</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">this_step</span> <span class="o">%</span> <span class="n">show_image_every</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">((</span><span class="s2">&quot;Step No.: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">this_step</span><span class="p">)))</span>
            <span class="n">display</span><span class="p">(</span><span class="n">im</span><span class="o">.</span><span class="n">resize</span><span class="p">((</span><span class="nb">int</span><span class="p">(</span><span class="n">width</span> <span class="o">*</span> <span class="n">img_rescale</span><span class="p">),</span> <span class="nb">int</span><span class="p">(</span><span class="n">height</span> <span class="o">*</span> <span class="n">img_rescale</span><span class="p">))))</span>
    <span class="k">return</span> <span class="n">image_list</span></div>


<span class="c1">###############	INIT FUNCTIONS	##################</span>
<div class="viewcode-block" id="leave_feeding_trace"><a class="viewcode-back" href="../physarum.html#physarum.leave_feeding_trace">[docs]</a><span class="k">def</span> <span class="nf">leave_feeding_trace</span><span class="p">(</span>
    <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">shape</span><span class="p">,</span> <span class="n">trace_strength</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">sigma</span><span class="o">=</span><span class="mi">7</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;wrap&quot;</span><span class="p">,</span> <span class="n">wrap_around</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">truncate</span><span class="o">=</span><span class="mi">4</span>
<span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Turns x,y-coordinates returned by a list of calls to init-functions into a smooth feeding array.&quot;&quot;&quot;</span>
    <span class="n">base</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">shape</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">wrap_around</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">x</span> <span class="o">%</span> <span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">y</span> <span class="o">%</span> <span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;CutOff overly large x and y: Not yet implemented.&quot;</span><span class="p">)</span>

    <span class="n">base</span><span class="p">[</span>
        <span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">x</span> <span class="o">%</span> <span class="p">(</span><span class="n">base</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">),</span>
        <span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">y</span> <span class="o">%</span> <span class="p">(</span><span class="n">base</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">),</span>
    <span class="p">]</span> <span class="o">=</span> <span class="n">trace_strength</span>
    <span class="n">base</span> <span class="o">=</span> <span class="n">gaussian_filter</span><span class="p">(</span><span class="n">base</span><span class="p">,</span> <span class="n">sigma</span><span class="o">=</span><span class="n">sigma</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="n">mode</span><span class="p">,</span> <span class="n">truncate</span><span class="o">=</span><span class="n">truncate</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">base</span></div>


<div class="viewcode-block" id="get_perlin_init"><a class="viewcode-back" href="../physarum.html#physarum.get_perlin_init">[docs]</a><span class="k">def</span> <span class="nf">get_perlin_init</span><span class="p">(</span>
    <span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="mi">1000</span><span class="p">,</span> <span class="mi">1000</span><span class="p">),</span>
    <span class="n">n</span><span class="o">=</span><span class="mi">100000</span><span class="p">,</span>
    <span class="n">cutoff</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">repetition</span><span class="o">=</span><span class="p">(</span><span class="mi">1000</span><span class="p">,</span> <span class="mi">1000</span><span class="p">),</span>
    <span class="n">scale</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
    <span class="n">octaves</span><span class="o">=</span><span class="mf">20.0</span><span class="p">,</span>
    <span class="n">persistence</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span>
    <span class="n">lacunarity</span><span class="o">=</span><span class="mf">2.0</span><span class="p">,</span>
<span class="p">):</span>

    <span class="sd">&quot;&quot;&quot;Returns a tuple of x,y-coordinates sampled from Perlin noise.</span>
<span class="sd">    This can be used to initialize the starting positions of a physarum-</span>
<span class="sd">    population, as well as to generate a cloudy feeding-pattern that will</span>
<span class="sd">    have a natural feel to it. This function wraps the one from the noise-</span>
<span class="sd">    library from Casey Duncan, and is in parts borrowed from here (see also this for a good explanation of the noise-parameters):</span>
<span class="sd">    https://medium.com/@yvanscher/playing-with-perlin-noise-generating-realistic-archipelagos-b59f004d8401</span>
<span class="sd">    The most relevant paramaters for our purposes are:</span>

<span class="sd">    :param shape: The shape of the area in which the noise is to be generated. Defaults to (1000,1000)</span>

<span class="sd">    :type shape: Tuple of integers with the form (width, height).</span>

<span class="sd">    :param n: Number of particles to sample. When used as a feeeding trace,</span>
<span class="sd">    this translates to the relative strength of the pattern. defaults to 100000.</span>

<span class="sd">    :param cutoff: value below which noise should be set to zero. Default is None. Will lead to probabilities &#39;contains NaN-error, if to high&#39;</span>

<span class="sd">    :param scale: (python-noise parameter) The scale of the noise -- larger or smaller patterns, defaults to 100.</span>

<span class="sd">    :param repetition: (python-noise parameter) Tuple that denotes the size of the area in which the noise should repeat itself. Defaults to (1000,1000)</span>




<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">shape</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">shape</span><span class="p">]</span>
    <span class="n">world</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">shape</span><span class="p">)</span>

    <span class="c1"># make coordinate grid on [0,1]^2</span>
    <span class="n">x_idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">y_idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">world_x</span><span class="p">,</span> <span class="n">world_y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">x_idx</span><span class="p">,</span> <span class="n">y_idx</span><span class="p">)</span>

    <span class="c1"># apply perlin noise, instead of np.vectorize, consider using itertools.starmap()</span>
    <span class="n">world</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vectorize</span><span class="p">(</span><span class="n">noise</span><span class="o">.</span><span class="n">pnoise2</span><span class="p">)(</span>
        <span class="n">world_x</span> <span class="o">/</span> <span class="n">scale</span><span class="p">,</span>
        <span class="n">world_y</span> <span class="o">/</span> <span class="n">scale</span><span class="p">,</span>
        <span class="n">octaves</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">octaves</span><span class="p">),</span>
        <span class="n">persistence</span><span class="o">=</span><span class="n">persistence</span><span class="p">,</span>
        <span class="n">lacunarity</span><span class="o">=</span><span class="n">lacunarity</span><span class="p">,</span>
        <span class="n">repeatx</span><span class="o">=</span><span class="n">repetition</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
        <span class="n">repeaty</span><span class="o">=</span><span class="n">repetition</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
        <span class="n">base</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">100</span><span class="p">),</span>
    <span class="p">)</span>
    <span class="c1"># world = world * 3</span>
    <span class="c1"># 	 Sample particle init from map:</span>
    <span class="n">world</span><span class="p">[</span><span class="n">world</span> <span class="o">&lt;=</span> <span class="mf">0.0</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>  <span class="c1"># filter negative values</span>
    <span class="k">if</span> <span class="n">cutoff</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">world</span><span class="p">[</span><span class="n">world</span> <span class="o">&lt;=</span> <span class="n">cutoff</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
    <span class="n">linear_idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span>
        <span class="n">world</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">n</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="n">world</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="n">world</span><span class="o">.</span><span class="n">sum</span><span class="p">())</span>
    <span class="p">)</span>
    <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unravel_index</span><span class="p">(</span><span class="n">linear_idx</span><span class="p">,</span> <span class="n">shape</span><span class="p">)</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">y</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span></div>


<div class="viewcode-block" id="get_circle_init"><a class="viewcode-back" href="../physarum.html#physarum.get_circle_init">[docs]</a><span class="k">def</span> <span class="nf">get_circle_init</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="mi">100000</span><span class="p">,</span> <span class="n">center</span><span class="o">=</span><span class="p">(</span><span class="mi">500</span><span class="p">,</span> <span class="mi">500</span><span class="p">),</span> <span class="n">radius</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">100</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Returns tuple of x,y-coordinates sampled from a ring with the given center, radius and width.&quot;&quot;&quot;</span>
    <span class="n">x</span> <span class="o">=</span> <span class="p">(</span><span class="n">center</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">radius</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="n">n</span><span class="p">)))</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">y</span> <span class="o">=</span> <span class="p">(</span><span class="n">center</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">radius</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="n">n</span><span class="p">)))</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="c1"># perturb coordinates:</span>

    <span class="n">x</span> <span class="o">=</span> <span class="n">x</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.333</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span> <span class="o">*</span> <span class="n">width</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">y</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.333</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span> <span class="o">*</span> <span class="n">width</span>
    <span class="k">return</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span></div>


<div class="viewcode-block" id="get_filled_circle_init"><a class="viewcode-back" href="../physarum.html#physarum.get_filled_circle_init">[docs]</a><span class="k">def</span> <span class="nf">get_filled_circle_init</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="mi">100000</span><span class="p">,</span> <span class="n">center</span><span class="o">=</span><span class="p">(</span><span class="mi">500</span><span class="p">,</span> <span class="mi">500</span><span class="p">),</span> <span class="n">radius</span><span class="o">=</span><span class="mi">200</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Returns tuple of x,y-coordinates sampled from a circle with the given center and radius&quot;&quot;&quot;</span>

    <span class="n">t</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
    <span class="n">r</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
    <span class="n">r</span><span class="p">[</span><span class="n">r</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">-</span> <span class="n">r</span><span class="p">[</span><span class="n">r</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">]</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">center</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">r</span> <span class="o">*</span> <span class="n">radius</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">center</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">r</span> <span class="o">*</span> <span class="n">radius</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">y</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span></div>


<div class="viewcode-block" id="get_gaussian_gradient"><a class="viewcode-back" href="../physarum.html#physarum.get_gaussian_gradient">[docs]</a><span class="k">def</span> <span class="nf">get_gaussian_gradient</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="mi">100000</span><span class="p">,</span> <span class="n">center</span><span class="o">=</span><span class="p">(</span><span class="mi">500</span><span class="p">,</span> <span class="mi">500</span><span class="p">),</span> <span class="n">sigma</span><span class="o">=</span><span class="mi">20</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Returns tuple of x,y-coordinates sampled from a 2-d gaussian around a given center with a given sigma&quot;&quot;&quot;</span>

    <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="n">center</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">sigma</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="n">center</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">sigma</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span></div>


<div class="viewcode-block" id="get_uniform_init"><a class="viewcode-back" href="../physarum.html#physarum.get_uniform_init">[docs]</a><span class="k">def</span> <span class="nf">get_uniform_init</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="mi">100000</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="mi">1000</span><span class="p">,</span> <span class="mi">1000</span><span class="p">)):</span>
    <span class="sd">&quot;&quot;&quot;Returns tuple of x,y-coordinates uniformly distributed over an area of the given shape.&quot;&quot;&quot;</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">size</span><span class="o">=</span><span class="n">n</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>  <span class="c1"># starting_position x</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">size</span><span class="o">=</span><span class="n">n</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>  <span class="c1"># starting_position y</span>
    <span class="k">return</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span></div>


<div class="viewcode-block" id="get_image_init_positions"><a class="viewcode-back" href="../physarum.html#physarum.get_image_init_positions">[docs]</a><span class="k">def</span> <span class="nf">get_image_init_positions</span><span class="p">(</span>
    <span class="n">image</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="mi">1000</span><span class="p">,</span> <span class="mi">1000</span><span class="p">),</span> <span class="n">n</span><span class="o">=</span><span class="mi">100000</span><span class="p">,</span> <span class="n">flip</span><span class="o">=</span><span class="kc">False</span>
<span class="p">):</span>  <span class="c1"># shape should be set to something similar to the prop. of the image</span>
    <span class="n">init_image</span> <span class="o">=</span> <span class="n">IMG</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">image</span><span class="p">)</span><span class="o">.</span><span class="n">convert</span><span class="p">(</span><span class="s2">&quot;L&quot;</span><span class="p">)</span>
    <span class="n">init_image</span> <span class="o">=</span> <span class="n">init_image</span><span class="o">.</span><span class="n">resize</span><span class="p">(</span><span class="nb">tuple</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">flip</span><span class="p">(</span><span class="n">shape</span><span class="p">)))</span>
    <span class="n">init_image</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">init_image</span><span class="p">)</span> <span class="o">/</span> <span class="mi">255</span>
    <span class="k">if</span> <span class="n">flip</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
        <span class="n">init_image</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">init_image</span>
    <span class="n">linear_idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span>
        <span class="n">init_image</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">n</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="n">init_image</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="n">init_image</span><span class="o">.</span><span class="n">sum</span><span class="p">())</span>
    <span class="p">)</span>
    <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unravel_index</span><span class="p">(</span><span class="n">linear_idx</span><span class="p">,</span> <span class="n">shape</span><span class="p">)</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">y</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span></div>


<div class="viewcode-block" id="get_image_init_array"><a class="viewcode-back" href="../physarum.html#physarum.get_image_init_array">[docs]</a><span class="k">def</span> <span class="nf">get_image_init_array</span><span class="p">(</span>
    <span class="n">image</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="mi">1000</span><span class="p">,</span> <span class="mi">1000</span><span class="p">)</span>
<span class="p">):</span>  <span class="c1"># shape should be set to something similar to the prop. of the image</span>
    <span class="n">init_image</span> <span class="o">=</span> <span class="n">IMG</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">image</span><span class="p">)</span><span class="o">.</span><span class="n">convert</span><span class="p">(</span><span class="s2">&quot;L&quot;</span><span class="p">)</span>
    <span class="n">init_image</span> <span class="o">=</span> <span class="n">init_image</span><span class="o">.</span><span class="n">resize</span><span class="p">(</span><span class="nb">tuple</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">flip</span><span class="p">(</span><span class="n">shape</span><span class="p">)))</span>
    <span class="n">init_image</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">init_image</span><span class="p">)</span> <span class="o">/</span> <span class="mi">255</span>
    <span class="k">return</span> <span class="n">init_image</span></div>


<span class="c1">################### COLOR FUNCTIONS ##################</span>


<div class="viewcode-block" id="my_hls_to_rgb"><a class="viewcode-back" href="../physarum.html#physarum.my_hls_to_rgb">[docs]</a><span class="k">def</span> <span class="nf">my_hls_to_rgb</span><span class="p">(</span><span class="n">color</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Turn HLS-triplet into RGB&quot;&quot;&quot;</span>
    <span class="n">hue</span> <span class="o">=</span> <span class="n">color</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="mi">360</span>
    <span class="n">saturation</span> <span class="o">=</span> <span class="n">color</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="mi">100</span>
    <span class="n">luminosity</span> <span class="o">=</span> <span class="n">color</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">/</span> <span class="mi">100</span>
    <span class="n">rgb</span> <span class="o">=</span> <span class="n">hls_to_rgb</span><span class="p">(</span><span class="n">hue</span><span class="p">,</span> <span class="n">luminosity</span><span class="p">,</span> <span class="n">saturation</span><span class="p">)</span>
    <span class="c1"># 	 rgb = [x * 255 for x in rgb]</span>
    <span class="k">return</span> <span class="n">rgb</span></div>


<div class="viewcode-block" id="make_colormap"><a class="viewcode-back" href="../physarum.html#physarum.make_colormap">[docs]</a><span class="k">def</span> <span class="nf">make_colormap</span><span class="p">(</span><span class="n">colorlist</span><span class="p">,</span> <span class="n">alpha_distribution</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">basecolor</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;returns a matplotlib colormap that goes through the values speciefied in hue, luminosity, saturation-format.</span>

<span class="sd">    :param alpha: How transparancey should be distributed over the colormap.</span>
<span class="sd">    List of the form [start alpha at this percentage, value of alpha at the start, end alpha at this percentage,</span>
<span class="sd">    value of alpha at the end.]. If True is passed, a standard value is used, if flase, the colormap has no alpha overlayed.</span>

<span class="sd">    :param basecolor: Basis on which to plot the transparant colormaps. Usually the background-color. (Not relevant for the actual colormap produced.)</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">these_colors</span> <span class="o">=</span> <span class="n">LinearSegmentedColormap</span><span class="o">.</span><span class="n">from_list</span><span class="p">(</span>
        <span class="s2">&quot;map&quot;</span><span class="p">,</span> <span class="p">[</span><span class="n">my_hls_to_rgb</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">colorlist</span><span class="p">],</span> <span class="n">N</span><span class="o">=</span><span class="mi">400</span>
    <span class="p">)</span>

    <span class="k">if</span> <span class="n">alpha_distribution</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
        <span class="n">these_colors</span> <span class="o">=</span> <span class="n">these_colors</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">400</span><span class="p">))</span>
        <span class="c1"># these_colors[0:100,-1] = np.linspace(0.0,0,100)</span>
        <span class="n">these_colors</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">400</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">,</span> <span class="mi">400</span><span class="p">)</span>
        <span class="n">these_colors</span> <span class="o">=</span> <span class="n">ListedColormap</span><span class="p">(</span><span class="n">these_colors</span><span class="p">)</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">alpha_distribution</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)):</span>
        <span class="n">these_colors</span> <span class="o">=</span> <span class="n">these_colors</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">400</span><span class="p">))</span>

        <span class="n">starting_point</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">alpha_distribution</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="mi">400</span><span class="p">)</span>
        <span class="n">ending_point</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">alpha_distribution</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">*</span> <span class="mi">400</span><span class="p">)</span>
        <span class="n">these_colors</span><span class="p">[:</span><span class="n">starting_point</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">these_colors</span><span class="p">[</span><span class="n">starting_point</span><span class="p">:</span><span class="n">ending_point</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span>
            <span class="n">alpha_distribution</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">alpha_distribution</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">ending_point</span> <span class="o">-</span> <span class="n">starting_point</span>
        <span class="p">)</span>
        <span class="n">these_colors</span><span class="p">[</span><span class="n">ending_point</span><span class="p">:,</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">alpha_distribution</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>

        <span class="n">these_colors</span> <span class="o">=</span> <span class="n">ListedColormap</span><span class="p">(</span><span class="n">these_colors</span><span class="p">)</span>

    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">pcolormesh</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">400</span><span class="p">,</span> <span class="mi">400</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="n">cmap</span><span class="o">=</span><span class="n">these_colors</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">basecolor</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_facecolor</span><span class="p">(</span><span class="n">basecolor</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">these_colors</span></div>


<span class="c1">################ SOME UTILS FOR INSPECTION ##############</span>


<div class="viewcode-block" id="plot_init_trace"><a class="viewcode-back" href="../physarum.html#physarum.plot_init_trace">[docs]</a><span class="k">def</span> <span class="nf">plot_init_trace</span><span class="p">(</span><span class="n">feeding_trace</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cm</span><span class="o">.</span><span class="n">get_cmap</span><span class="p">(</span><span class="s2">&quot;viridis&quot;</span><span class="p">),</span> <span class="n">scale</span><span class="o">=</span><span class="mf">0.3</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Displays a given trace_array, to check what it would look like&quot;&quot;&quot;</span>
    <span class="n">im</span> <span class="o">=</span> <span class="p">(</span><span class="n">feeding_trace</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">feeding_trace</span><span class="p">))</span> <span class="o">/</span> <span class="p">(</span>
        <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">feeding_trace</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">feeding_trace</span><span class="p">)</span>
    <span class="p">)</span>
    <span class="n">im</span> <span class="o">=</span> <span class="n">cmap</span><span class="p">(</span><span class="n">im</span><span class="p">)</span>  <span class="c1"># to take a look at our feeding trace..</span>
    <span class="n">im</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">(</span><span class="n">im</span> <span class="o">*</span> <span class="mi">255</span><span class="p">)</span>
    <span class="n">display</span><span class="p">(</span>
        <span class="n">IMG</span><span class="o">.</span><span class="n">fromarray</span><span class="p">(</span><span class="n">im</span><span class="p">)</span><span class="o">.</span><span class="n">resize</span><span class="p">(</span>
            <span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">feeding_trace</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">scale</span><span class="p">),</span> <span class="nb">int</span><span class="p">(</span><span class="n">feeding_trace</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">scale</span><span class="p">))</span>
        <span class="p">)</span>
    <span class="p">)</span></div>


<div class="viewcode-block" id="test_spline"><a class="viewcode-back" href="../physarum.html#physarum.test_spline">[docs]</a><span class="k">def</span> <span class="nf">test_spline</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">t</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Plots the spline that will be extrapolated for a list of changing constants.</span>

<span class="sd">    :param value: list of values</span>
<span class="sd">    :param t: number of timesteps to take</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">anchors</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">value</span><span class="p">))</span>
    <span class="n">base</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">t</span><span class="p">)</span>

    <span class="n">spline_points</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">anchors</span><span class="p">,</span> <span class="n">value</span><span class="p">])</span><span class="o">.</span><span class="n">T</span>

    <span class="n">tck</span> <span class="o">=</span> <span class="n">interpolate</span><span class="o">.</span><span class="n">splrep</span><span class="p">(</span>
        <span class="n">spline_points</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span>
        <span class="n">spline_points</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span>
        <span class="n">s</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
        <span class="n">k</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">([</span><span class="nb">len</span><span class="p">(</span><span class="n">spline_points</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">])</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]),</span>
    <span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">base</span><span class="p">,</span> <span class="n">interpolate</span><span class="o">.</span><span class="n">splev</span><span class="p">(</span><span class="n">base</span><span class="p">,</span> <span class="n">tck</span><span class="p">))</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">anchors</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">value</span><span class="p">)</span></div>


<span class="c1">################ Saving #####################</span>


<div class="viewcode-block" id="save_film"><a class="viewcode-back" href="../physarum.html#physarum.save_film">[docs]</a><span class="k">def</span> <span class="nf">save_film</span><span class="p">(</span><span class="n">images</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">fps</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s2">&quot;mp4&quot;</span><span class="p">,</span> <span class="n">loop</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>

    <span class="k">if</span> <span class="n">name</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
        <span class="n">now</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>  <span class="c1"># current date and time</span>
        <span class="n">date_time</span> <span class="o">=</span> <span class="n">now</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%m-</span><span class="si">%d</span><span class="s2">-%Y--%H-%M-%S&quot;</span><span class="p">)</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">date_time</span> <span class="o">+</span> <span class="s2">&quot;.mp4&quot;</span>

    <span class="k">if</span> <span class="n">loop</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
        <span class="n">a</span> <span class="o">=</span> <span class="n">images</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">images</span><span class="o">.</span><span class="n">reverse</span><span class="p">()</span>
        <span class="n">images</span> <span class="o">=</span> <span class="n">a</span> <span class="o">+</span> <span class="n">images</span>

    <span class="n">imageio</span><span class="o">.</span><span class="n">mimsave</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">images</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="nb">format</span><span class="p">,</span> <span class="n">fps</span><span class="o">=</span><span class="n">fps</span><span class="p">)</span></div>


<div class="viewcode-block" id="save_grid"><a class="viewcode-back" href="../physarum.html#physarum.save_grid">[docs]</a><span class="k">def</span> <span class="nf">save_grid</span><span class="p">(</span><span class="n">images</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">folder</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>

    <span class="n">images_to_use</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">images</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">5</span> <span class="o">*</span> <span class="mi">5</span><span class="p">)]</span>

    <span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>

    <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">])</span>

    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">):</span>
        <span class="n">space</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">k</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">([</span><span class="n">x</span><span class="p">,</span> <span class="n">space</span><span class="p">]),</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">([</span><span class="n">y</span><span class="p">,</span> <span class="n">space</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">([</span><span class="n">x</span><span class="p">,</span> <span class="n">space</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]]),</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">([</span><span class="n">y</span><span class="p">,</span> <span class="n">space</span><span class="p">])</span>

    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">):</span>
        <span class="n">space</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="mi">5</span> <span class="o">-</span> <span class="n">k</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">k</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">([</span><span class="n">x</span><span class="p">,</span> <span class="n">space</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]]),</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">([</span><span class="n">y</span><span class="p">,</span> <span class="n">space</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">([</span><span class="n">x</span><span class="p">,</span> <span class="n">space</span><span class="p">]),</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">([</span><span class="n">y</span><span class="p">,</span> <span class="n">space</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]])</span>

    <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)):</span>
        <span class="n">a</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">s</span><span class="p">]),</span> <span class="nb">int</span><span class="p">(</span><span class="n">y</span><span class="p">[</span><span class="n">s</span><span class="p">])]</span> <span class="o">=</span> <span class="n">images_to_use</span><span class="p">[</span><span class="n">s</span><span class="p">]</span>

    <span class="n">rows</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="o">.</span><span class="n">tqdm_notebook</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">a</span><span class="p">))):</span>
        <span class="n">rows</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
            <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">pic</span><span class="p">)</span> <span class="k">for</span> <span class="n">pic</span> <span class="ow">in</span> <span class="p">[</span><span class="n">images</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">j</span><span class="p">)]</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:]]])</span>
        <span class="p">)</span>

    <span class="n">image_collection</span> <span class="o">=</span> <span class="n">IMG</span><span class="o">.</span><span class="n">fromarray</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">(</span><span class="n">rows</span><span class="p">))</span>
    <span class="n">display</span><span class="p">(</span><span class="n">image_collection</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">name</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
        <span class="n">now</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>  <span class="c1"># current date and time</span>
        <span class="n">date_time</span> <span class="o">=</span> <span class="n">now</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%m-</span><span class="si">%d</span><span class="s2">-%Y--%H-%M-%S&quot;</span><span class="p">)</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">date_time</span> <span class="o">+</span> <span class="s2">&quot;.png&quot;</span>

    <span class="k">if</span> <span class="n">folder</span> <span class="o">!=</span> <span class="kc">False</span><span class="p">:</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">folder</span> <span class="o">+</span> <span class="n">name</span>
    <span class="n">image_collection</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">name</span><span class="p">)</span></div>


<div class="viewcode-block" id="save_single_image_grid"><a class="viewcode-back" href="../physarum.html#physarum.save_single_image_grid">[docs]</a><span class="k">def</span> <span class="nf">save_single_image_grid</span><span class="p">(</span>
    <span class="n">images</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">folder</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">image_no</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">dimensions</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
<span class="p">):</span>

    <span class="k">if</span> <span class="n">image_no</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
        <span class="n">tile_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">images</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])]</span> <span class="o">*</span> <span class="n">dimensions</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">tile_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">images</span><span class="p">[</span><span class="n">image_no</span><span class="p">])]</span> <span class="o">*</span> <span class="n">dimensions</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

    <span class="n">tile_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">([</span><span class="n">tile_array</span><span class="p">]</span> <span class="o">*</span> <span class="n">dimensions</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">image_collection</span> <span class="o">=</span> <span class="n">IMG</span><span class="o">.</span><span class="n">fromarray</span><span class="p">(</span><span class="n">tile_array</span><span class="p">)</span>

    <span class="n">display</span><span class="p">(</span><span class="n">image_collection</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">name</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
        <span class="n">now</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>  <span class="c1"># current date and time</span>
        <span class="n">date_time</span> <span class="o">=</span> <span class="n">now</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%m-</span><span class="si">%d</span><span class="s2">-%Y--%H-%M-%S&quot;</span><span class="p">)</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">date_time</span> <span class="o">+</span> <span class="s2">&quot;.png&quot;</span>

    <span class="k">if</span> <span class="n">folder</span> <span class="o">!=</span> <span class="kc">False</span><span class="p">:</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">folder</span> <span class="o">+</span> <span class="n">name</span>
    <span class="n">image_collection</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>

    <span class="n">image_collection</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="s2">&quot;physarum_tiles/&quot;</span> <span class="o">+</span> <span class="n">date_time</span> <span class="o">+</span> <span class="s2">&quot;.png&quot;</span><span class="p">)</span></div>
</pre></div>

          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../index.html">physarum</a></h1>








<h3>Navigation</h3>
<p class="caption"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../physarum.html">physarum package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../examples.html">Physarum</a></li>
<li class="toctree-l1"><a class="reference internal" href="../setup.html">setup module</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../index.html">Documentation overview</a><ul>
  <li><a href="index.html">Module code</a><ul>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2020, Maximilian Noichl.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 3.3.1</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
    </div>

    

    
  </body>
</html>